<div class="loading-indicator" *ngIf="loading">
  <p-progressSpinner [style]="{width: '50px', height: '50px'}" strokeWidth="8" fill="#EEEEEE" animationDuration=".5s">
  </p-progressSpinner>
</div>

<div class="bao-hiem-thue">
  <div class="col-md-12 list-btn-edit p-0" style="text-align: right;">
    <i *ngIf="!isEdit && isShowButton" class="pi pi-pencil icons" (click)="enabledForm()"></i>
    <i *ngIf="isEdit" class="pi pi-check icons icons-check" (click)="saveForm()"></i>
    <i *ngIf="isEdit" class="pi pi-times icons icons-times" (click)="disabledForm()"></i>
  </div>
  <form class="form-horizontal" [formGroup]="baoHiemForm">
    <p class="title-tab">Thông tin bảo hiểm và thuế</p>
    <div class="col-md-12 border-box">
      <p class="title-tab">Thông tin thuế và giảm trừ</p>
      <div class="row form-row">
        <div class="col-md-6 form-group">
          <label>Mã số thuế cá nhân:</label>
          <input type="text" pInputText formControlName="MaSoThueCaNhan" class="w-100"
            [ngClass]="submitted && baoHiemForm.controls.MaSoThueCaNhan.errors ? 'error-border': ''" />
          <!-- <p class="required" *ngIf="submitted && baoHiemForm.controls.MaSoThueCaNhan.errors">{{
            error['MaSoThueCaNhan'] }}
          </p> -->
        </div>
      </div>
      <div class="row form-row">
        <div class="col-md-6 form-group">
          <label>Số người đăng ký phụ thuộc:</label>
          <input type="text" pInputText formControlName="SoNguoiDangKyPhuThuoc" class="w-100">
        </div>
        <div class="col-md-6 form-group">
          <label>Đối tượng phụ thuộc:</label>
          <input type="text" pInputText formControlName="DoiTuongPhuThuoc" class="w-100">
        </div>
        <!-- <div class="col-md-6 form-group">
          <label>Tháng nộp đăng ký giảm trừ:</label>
          <p-calendar view="month" [yearNavigator]="true" yearRange="2000:2030" dateFormat="mm/yy" [baseZIndex]="9999"
            formControlName="ThangNopDangKyGiamTru" [style]="{'width':'100%'}" showButtonBar="true"
            [inputStyle]="{'width':'100%'}" appendTo="body">
          </p-calendar>
        </div> -->
      </div>
    </div>
    <div class="col-md-12 border-box mt-3">
      <p class="title-tab">Bảo hiểm xã hội</p>
      <div class="row form-row">
        <div class="col-md-3 form-group">
          <label>Số sổ BHXH:</label>
          <input type="text" pInputText formControlName="SoSoBhxh" class="w-100"
            [ngClass]="submitted && baoHiemForm.controls.SoSoBhxh.errors ? 'error-border': ''" />
          <!-- <p class="required" *ngIf="submitted && baoHiemForm.controls.SoSoBhxh.errors">{{
            error['SoSoBhxh'] }}
          </p> -->
        </div>
        <div class="col-md-3 form-group">
          <label>Mã thẻ BHYT:</label>
          <input type="text" pInputText formControlName="MaTheBhyt" class="w-100"
            [ngClass]="submitted && baoHiemForm.controls.MaTheBhyt.errors ? 'error-border': ''" />
          <!-- <p class="required" *ngIf="submitted && baoHiemForm.controls.MaTheBhyt.errors">{{
            error['MaTheBhyt'] }}
          </p> -->
        </div>
        <div class="col-md-3 form-group">
          <label>Mức đóng BHXH:</label>
          <p-inputNumber formControlName="MucDongBhxh" class="w-100"></p-inputNumber>
        </div>
      </div>
      <div class="row form-row">
        <div class="col-md-3 form-group">
          <label>Tỷ lệ đóng BHXH</label>
          <input type="text" pInputText formControlName="TyLeDongBhxh" class="w-100" />
        </div>
        <div class="col-md-3 form-group">
          <label>Tỷ lệ đóng BHYT:</label>
          <input type="text" pInputText formControlName="TyLeDongBhyt" class="w-100" />
        </div>
        <div class="col-md-3 form-group">
          <label>Tỷ lệ đóng BHTN:</label>
          <input type="text" pInputText formControlName="TyLeDongBhtn" class="w-100" />
        </div>
        <div class="col-md-3 form-group">
          <label>Tỷ lệ đóng BHTNNN:</label>
          <input type="text" pInputText formControlName="TyLeDongBhtnnn" class="w-100" />
        </div>
      </div>
    </div>

    <div class="col-md-12 border-box mt-3">
      <p class="title-tab">Bảo hiểm LoftCare</p>
      <div class="row form-row">
        <div class="col-md-3 form-group">
          <label>Mã thẻ BH Loftcare:</label>
          <input type="text" pInputText formControlName="MaTheBhLoftCare" class="w-100"
            [ngClass]="submitted && baoHiemForm.controls.MaTheBhLoftCare.errors ? 'error-border': ''" />
          <!-- <p class="required" *ngIf="submitted && baoHiemForm.controls.MaTheBhLoftCare.errors">{{
            error['MaTheBhLoftCare'] }}
          </p> -->
        </div>
        <div class="col-md-3 form-group">
          <label>Nhóm:</label>
          <input type="text" pInputText formControlName="NhomBhLoftCare" class="w-100"/>
        </div>
      </div>
      <div class="row form-row">
        <div class="col-md-12 form-group">
          <p-table #myTable [columns]="cols" [value]="listQuyenLoi" [responsive]="true" class="table-border">
            <ng-template pTemplate="header" let-columns>
              <tr>
                <th *ngFor="let col of columns"
                  [ngStyle]="{ 'text-align': col.textAlign, 'display': col.display, 'width': col.width }">
                  <span>
                    {{col.header}}
                  </span>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-columns="columns">
              <tr>
                <td *ngFor="let col of columns" class="ui-resizable-column" [ngSwitch]="col.field"
                  [ngStyle]="{ 'text-align': col.textAlign, 'display': col.display, 'width': col.width }">
                  <span class="ui-column-title">{{col.header}}</span>
                  <span *ngSwitchCase="'mucHuong'">
                    {{ rowData[col.field] | number}}
                  </span>
                  <span *ngSwitchCase="'phiCoDinh'">
                    {{ rowData[col.field] | number}}
                  </span>
                  <span *ngSwitchDefault>{{rowData[col.field]}}</span>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage" let-columns>
              <tr>
                <td [attr.colspan]="columns.length">
                  Hiện tại không có dữ liệu
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
    <div class="col-md-12 border-box mt-3 mb-3">
      <div class="row">
        <div class="col-md-6">
          <p class="title-tab">Lịch sử thanh toán quyền lợi bảo hiểm</p>
        </div>
        <div class="col-md-6 text-right">
          <button *ngIf="isShowButton" pButton type="button" label="Thêm mới" class="btn btn-create" (click)="addLichSu()"></button>
        </div>
      </div>
      <div class="row form-row">
        <div class="col-md-12 form-group">
          <p-table #myTable [columns]="cols2" [value]="listLichSuThanhToanBaoHiem" [responsive]="true" class="table-border">
            <ng-template pTemplate="header" let-columns>
              <tr>
                <th *ngFor="let col of columns"
                  [ngStyle]="{ 'text-align': col.textAlign, 'display': col.display, 'width': col.width }">
                  <span>
                    {{col.header}}
                  </span>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-columns="columns" let-index="rowIndex">
              <tr>
                <td *ngFor="let col of columns" class="ui-resizable-column" [ngSwitch]="col.field"
                  [ngStyle]="{ 'text-align': col.textAlign, 'display': col.display, 'width': col.width }">
                  <span class="ui-column-title">{{col.header}}</span>
                  <span *ngSwitchCase="'stt'">
                    {{ index + 1}}
                  </span>
                  <span *ngSwitchCase="'ngayThanhToan'">
                    {{ rowData[col.field] | date: 'dd/MM/yyyy'}}
                  </span>
                  <span *ngSwitchCase="'soTienThanhToan'">
                    {{ rowData[col.field] | number}}
                  </span>
                  <span *ngSwitchCase="'action'">
                    <button *ngIf="isShowButton" pButton icon="pi pi-pencil" (click)="addLichSu(rowData)"></button>
                    <button *ngIf="isShowButton" class="ui-button-danger ml-1" pButton icon="pi pi-trash" (click)="deleteLichSu(rowData)"></button>
                  </span>
                  <span *ngSwitchDefault>{{rowData[col.field]}}</span>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage" let-columns>
              <tr>
                <td [attr.colspan]="columns.length">
                  Hiện tại không có dữ liệu
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
  </form>
</div>